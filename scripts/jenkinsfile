def templatePath = 'https://github.com/OpenShiftDemos/openshift-tasks/blob/master/app-template.yaml'
def templateName = 'openshift-tasks'
def APP_NAME = 'tasks'
def DEV_PROJECT = 'tasks-dev'
def TEST_PROJECT = 'tasks-test'
def PROD_PROJECT = 'tasks-prod'
def BUILD_PROJECT = 'tasks-prod'


pipeline {
  agent {
    node {
      label 'maven'
    }
  }
  options {
    timeout(time: 20, unit: 'MINUTES')
  }
  stages {
    stage('Build') {
      steps {
        scripts {
          openshift.withCluster() {
            openshift.withProject(DEV_PROJECT) {
              def buildConfig = openshift.selector('bc'/APP_NAME)
              openshift.withProject(BUILD_PROJECT) {
                def build = buildConfig.startBuild()
                build.logs(-f)
              }

            }
          }
        }
      }
    }
    stage('Deploy to dev') {
      steps {
        scripts {
          openshift.withCluster() {
            openshift.withProject(BUILD_PROJECT) {
              def deploymentConfig = openshift.selector('dc'/APP_NAME)
              openshift.withProject(DEV_PROJECT) {
                deploymentConfig.deploy()
              }
            }
          }
        }
      }
    }

  }
}
